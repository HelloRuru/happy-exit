import { useState, useEffect, ReactNode } from 'react';

// Icons
const ChevronRight = ({ className = "w-5 h-5" }: { className?: string }) => <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="2"><path d="M9 18l6-6-6-6" strokeLinecap="round" strokeLinejoin="round"/></svg>;
const ChevronLeft = ({ className = "w-5 h-5" }: { className?: string }) => <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="2"><path d="M15 18l-6-6 6-6" strokeLinecap="round" strokeLinejoin="round"/></svg>;
const InfoIcon = ({ className = "w-5 h-5" }: { className?: string }) => <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01" strokeLinecap="round"/></svg>;
const LockIcon = ({ className = "w-4 h-4" }: { className?: string }) => <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>;
const CopyIcon = ({ className = "w-5 h-5" }: { className?: string }) => <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>;
const CheckIcon = ({ className = "w-5 h-5" }: { className?: string }) => <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="2"><path d="M20 6L9 17l-5-5" strokeLinecap="round" strokeLinejoin="round"/></svg>;
const HomeIcon = ({ className = "w-5 h-5" }: { className?: string }) => <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9,22 9,12 15,12 15,22"/></svg>;
const DownloadIcon = ({ className = "w-5 h-5" }: { className?: string }) => <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7,10 12,15 17,10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>;
const AlertIcon = ({ className = "w-5 h-5" }: { className?: string }) => <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="2"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>;
const CalcIcon = ({ className = "w-5 h-5" }: { className?: string }) => <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="2"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="16" y2="6"/></svg>;
const ShieldIcon = ({ className = "w-5 h-5" }: { className?: string }) => <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>;
const FileIcon = ({ className = "w-5 h-5" }: { className?: string }) => <svg viewBox="0 0 24 24" fill="none" className={className} stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14,2 14,8 20,8"/></svg>;

// Reusable Components (defined outside App to prevent re-creation)
const Privacy = () => <div className="flex items-center justify-center gap-2 text-xs text-gray-500 py-2"><LockIcon className="w-3 h-3"/><span>è³‡æ–™åƒ…å­˜åœ¨ä½ çš„ç€è¦½å™¨</span></div>;
const Legal = ({children}:{children:ReactNode}) => <div className="bg-amber-50 border-l-4 border-amber-400 p-3 rounded-r-xl"><div className="flex items-start gap-2"><InfoIcon className="w-4 h-4 text-amber-600 flex-shrink-0 mt-0.5"/><div className="text-xs text-amber-800">{children}</div></div></div>;
const Warn = ({children}:{children:ReactNode}) => <div className="bg-red-50 border-l-4 border-red-400 p-3 rounded-r-xl"><div className="flex items-start gap-2"><AlertIcon className="w-4 h-4 text-red-600 flex-shrink-0 mt-0.5"/><div className="text-xs text-red-800">{children}</div></div></div>;
const Footer = () => <div className="mt-4 p-3 bg-white/80 rounded-xl border border-gray-100 text-center"><p className="text-xs text-gray-600">âš ï¸ ä¾ã€Šå‹åŸºæ³•ã€‹è¨ˆç®—ï¼Œåƒ…ä¾›åƒè€ƒã€‚è«®è©¢è«‹æ´½ <a href="tel:1955" className="text-[#6B8CAE] font-bold">1955</a></p><Privacy/><p className="text-xs text-gray-400 mt-2">Â© 2026 <a href="https://kaorutsai.com" target="_blank" rel="noopener noreferrer" className="hover:text-[#6B8CAE]">Kaoru Tsai</a>. All Rights Reserved.</p></div>;
const Page = ({children}:{children:ReactNode}) => <div className="min-h-screen w-full bg-gradient-to-br from-[#FFF9F0] to-[#FFD97D]/10 p-3 sm:p-4 md:p-6"><div className="w-full max-w-2xl mx-auto space-y-4">{children}</div></div>;
const Btn = ({onClick,disabled,variant='primary',children}:{onClick:()=>void;disabled?:boolean;variant?:string;children:ReactNode}) => <button onClick={onClick} disabled={disabled} className={`flex-1 py-3 px-4 rounded-full font-medium text-sm transition-all flex items-center justify-center gap-1 ${variant==='primary'?'bg-[#6B8CAE] text-white hover:bg-[#6B8CAE]/90 disabled:bg-gray-300 disabled:cursor-not-allowed':'bg-gray-100 text-gray-600 hover:bg-gray-200'}`}>{children}</button>;
const Progress = ({n,t}:{n:number;t:number}) => <div className="flex items-center gap-2 mb-2"><div className="flex-1 h-2 bg-gray-200 rounded-full overflow-hidden"><div className="h-full bg-[#6B8CAE] transition-all" style={{width:`${(n/t)*100}%`}}/></div><span className="text-xs text-gray-500">{n}/{t}</span></div>;
const Enc = ({text}:{text:string}) => <div className="bg-gradient-to-r from-[#FFD97D]/30 to-[#FFB6A3]/20 rounded-xl p-3"><p className="text-[#6B8CAE] text-sm">{text}</p></div>;
const Menu = ({icon,title,desc,onClick,badge}:{icon:ReactNode;title:string;desc:string;onClick:()=>void;badge?:string}) => <button onClick={onClick} className="w-full bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition-all text-left flex items-start gap-3 border border-gray-100"><div className="w-10 h-10 rounded-full bg-[#6B8CAE]/10 flex items-center justify-center text-[#6B8CAE] flex-shrink-0">{icon}</div><div className="flex-1"><div className="flex items-center gap-2"><h3 className="font-bold text-gray-800">{title}</h3>{badge&&<span className="text-xs bg-red-100 text-red-600 px-2 py-0.5 rounded-full">{badge}</span>}</div><p className="text-xs text-gray-500 mt-1">{desc}</p></div><ChevronRight className="w-5 h-5 text-gray-400"/></button>;
const CopyBtn = ({text,id,copiedId,onCopy}:{text:string;id:string;copiedId:string|null;onCopy:(t:string,id:string)=>void}) => <button onClick={()=>onCopy(text,id)} className="flex items-center gap-1 px-3 py-1.5 bg-[#6B8CAE] text-white rounded-lg text-xs hover:bg-[#6B8CAE]/90">{copiedId===id?<CheckIcon className="w-3 h-3"/>:<CopyIcon className="w-3 h-3"/>}{copiedId===id?'å·²è¤‡è£½':'è¤‡è£½'}</button>;

interface ChecklistItem { id: string; text: string; checked: boolean; category: string; priority: 'must' | 'should' | 'optional'; note?: string; }

function App() {
  const [stage, setStage] = useState('welcome');
  const [dateMode, setDateMode] = useState<'known' | 'unknown'>('known');
  const [copiedId, setCopiedId] = useState<string | null>(null);
  const [form, setForm] = useState({ joinDate: '', leaveDate: '', noticeDate: '', company: '', department: '', position: '', supervisorName: '', employeeName: '', reasons: [] as string[], reasonOther: '', tone: 'friendly' as const, hasHandover: true, gratitude: '', monthlySalary: 0, insuredSalary: 0, usedAnnualLeave: 0, isInvoluntary: false, severanceReason: '', dependents: 0, isOver45: false, hasDisability: false, insuranceYears: 1 });
  const [calc, setCalc] = useState({ tenure: { years: 0, months: 0, days: 0 }, noticeRequired: 0, deadlineToResign: '', earliestLeaveDate: '', annualLeave: 0, jobSearchLeave: 0, remainingLeave: 0, leaveCompensation: 0, severancePay: 0, noticeWage: 0, unemploymentBenefit: 0, unemploymentMonths: 0, trainingAllowance: 0, earlyEmploymentBonus: 0, healthInsuranceSubsidy: 0, totalGovernmentBenefit: 0 });

  const defaultChecklist: ChecklistItem[] = [
    { id: 'c1', text: 'æäº¤æ›¸é¢é›¢è·ä¿¡', checked: false, category: 'æ³•å¾‹æ¬Šç›Š', priority: 'must' },
    { id: 'c2', text: 'ç¢ºèªé›¢è·æ—¥æœŸå·²æ ¸å‡†', checked: false, category: 'æ³•å¾‹æ¬Šç›Š', priority: 'must' },
    { id: 'c3', text: 'ç´¢å–é›¢è·è­‰æ˜æ›¸ï¼ˆç¢ºèªä»£ç¢¼ï¼‰', checked: false, category: 'æ³•å¾‹æ¬Šç›Š', priority: 'must', note: 'éè‡ªé¡˜é›¢è·éœ€ç¢ºèªä»£ç¢¼ç¬¦åˆå¤±æ¥­çµ¦ä»˜' },
    { id: 'c4', text: 'ç´¢å–æœå‹™è­‰æ˜æ›¸ï¼ˆç„¡ä¸åˆ©è¨˜è¼‰ï¼‰', checked: false, category: 'æ³•å¾‹æ¬Šç›Š', priority: 'must', note: 'ä¾å‹åŸºæ³•Â§19' },
    { id: 'c5', text: 'ç¢ºèªç‰¹ä¼‘çµç®—æ–¹å¼èˆ‡é‡‘é¡', checked: false, category: 'æ³•å¾‹æ¬Šç›Š', priority: 'must' },
    { id: 'c6', text: 'ç¢ºèªè–ªè³‡çµç®—æ—¥æœŸèˆ‡é‡‘é¡', checked: false, category: 'æ³•å¾‹æ¬Šç›Š', priority: 'must' },
    { id: 'c7', text: 'ç¢ºèªå‹å¥ä¿è½‰å‡ºå–®', checked: false, category: 'æ³•å¾‹æ¬Šç›Š', priority: 'must' },
    { id: 'c8', text: 'æª¢æŸ¥å‹é€€6%æœ€å¾Œæç¹³ç´€éŒ„', checked: false, category: 'æ³•å¾‹æ¬Šç›Š', priority: 'must', note: 'è‡³å‹ä¿å±€eåŒ–æœå‹™æŸ¥è©¢' },
    { id: 'c9', text: 'ä¸‹è¼‰è–ªè³‡å–®/æ‰£ç¹³æ†‘å–®ï¼ˆè¿‘å…©å¹´ï¼‰', checked: false, category: 'æ³•å¾‹æ¬Šç›Š', priority: 'must', note: 'æˆ¿è²¸ç”³è«‹èˆ‡å ±ç¨…æ†‘è­‰' },
    { id: 'c10', text: 'ç¢ºèªç«¶æ¥­ç¦æ­¢æ¢æ¬¾æ˜¯å¦æœ‰æ•ˆ', checked: false, category: 'æ³•å¾‹æ¬Šç›Š', priority: 'should', note: 'ç„¡æœˆè£œå„Ÿé‡‘è€…å¤šç‚ºç„¡æ•ˆ' },
    { id: 'c11', text: 'ä½¿ç”¨è¬€è·å‡ï¼ˆé å‘ŠæœŸæ¯é€±2æ—¥æœ‰è–ªï¼‰', checked: false, category: 'æ³•å¾‹æ¬Šç›Š', priority: 'should' },
    { id: 'c12', text: 'åˆ—å‡ºç›®å‰è² è²¬çš„å·¥ä½œæ¸…å–®', checked: false, category: 'å·¥ä½œäº¤æ¥', priority: 'must' },
    { id: 'c13', text: 'æ•´ç†å°ˆæ¡ˆæ–‡ä»¶è³‡æ–™', checked: false, category: 'å·¥ä½œäº¤æ¥', priority: 'must' },
    { id: 'c14', text: 'æ’°å¯«äº¤æ¥æ–‡ä»¶', checked: false, category: 'å·¥ä½œäº¤æ¥', priority: 'must' },
    { id: 'c15', text: 'èˆ‡æ¥æ‰‹åŒäº‹äº¤æ¥æœƒè­°', checked: false, category: 'å·¥ä½œäº¤æ¥', priority: 'must' },
    { id: 'c16', text: 'ç¢ºèªå¸³è™Ÿå¯†ç¢¼å·²äº¤æ¥', checked: false, category: 'å·¥ä½œäº¤æ¥', priority: 'must' },
    { id: 'c17', text: 'äº¤æ¥æª”æ¡ˆçµæ§‹åŒ–å‘½å', checked: false, category: 'å·¥ä½œäº¤æ¥', priority: 'should', note: 'YYYYMMDD_å°ˆæ¡ˆå_äº¤æ¥ç‰ˆ' },
    { id: 'c18', text: 'å‚™ä»½å€‹äººæ–¹æ³•è«–/SOP/æ¨¡æ¿', checked: false, category: 'æ•¸ä½å®‰å…¨', priority: 'must', note: 'ä¿ç•™æŠ€èƒ½è€Œéå…¬å¸è³‡æ–™' },
    { id: 'c19', text: 'å¤–éƒ¨å¸³è™Ÿæ›ç¶å€‹äººä¿¡ç®±', checked: false, category: 'æ•¸ä½å®‰å…¨', priority: 'must', note: 'Notion,Figma,Canvaç­‰' },
    { id: 'c20', text: 'å…¬å¸ä¿¡ç®±é—œéµå­—æ¸…é™¤', checked: false, category: 'æ•¸ä½å®‰å…¨', priority: 'must', note: 'é¢è©¦ã€è–ªè³‡ã€é«”æª¢ã€ç§äºº' },
    { id: 'c21', text: 'æ¸…ç©ºåƒåœ¾æ¡¶Hard Delete', checked: false, category: 'æ•¸ä½å®‰å…¨', priority: 'must' },
    { id: 'c22', text: 'ç™»å‡ºç€è¦½å™¨/æ¸…é™¤å¯†ç¢¼Cookies', checked: false, category: 'æ•¸ä½å®‰å…¨', priority: 'must' },
    { id: 'c23', text: 'ä½œå“é›†å»è­˜åˆ¥åŒ–è™•ç†', checked: false, category: 'æ•¸ä½å®‰å…¨', priority: 'should', note: 'æ•¸æ“šè½‰ç™¾åˆ†æ¯”' },
    { id: 'c24', text: 'æ­¸é‚„å“¡å·¥è­‰/é–€ç¦å¡', checked: false, category: 'ç‰©å“æ­¸é‚„', priority: 'must' },
    { id: 'c25', text: 'æ­¸é‚„å…¬å¸é›»è…¦è¨­å‚™', checked: false, category: 'ç‰©å“æ­¸é‚„', priority: 'must' },
    { id: 'c26', text: 'æ¸…ç©ºå€‹äººç‰©å“', checked: false, category: 'ç‰©å“æ­¸é‚„', priority: 'must' },
    { id: 'c27', text: 'èˆ‡ä¸»ç®¡é›¢è·é¢è«‡', checked: false, category: 'äººéš›é—œä¿‚', priority: 'must' },
    { id: 'c28', text: 'å‘åŒäº‹é“åˆ¥', checked: false, category: 'äººéš›é—œä¿‚', priority: 'should' },
    { id: 'c29', text: 'ç™¼é€Farewell Email', checked: false, category: 'äººéš›é—œä¿‚', priority: 'should' },
    { id: 'c30', text: 'è«‹æ±‚LinkedInæ¨è–¦', checked: false, category: 'äººéš›é—œä¿‚', priority: 'optional' },
  ];
  const [checklist, setChecklist] = useState<ChecklistItem[]>(defaultChecklist);

  useEffect(() => { const s = localStorage.getItem('resignV3'); if (s) { try { const d = JSON.parse(s); setStage(d.stage||'welcome'); setDateMode(d.dateMode||'known'); if(d.form) setForm(p=>({...p,...d.form})); if(d.calc) setCalc(p=>({...p,...d.calc})); if(d.checklist) setChecklist(d.checklist); } catch(e){} } }, []);
  useEffect(() => { localStorage.setItem('resignV3', JSON.stringify({ stage, dateMode, form, calc, checklist })); }, [stage, dateMode, form, calc, checklist]);

  const calcTenure = (j: string, e: string) => { if(!j||!e) return {years:0,months:0,days:0}; const jd=new Date(j),ed=new Date(e); let y=ed.getFullYear()-jd.getFullYear(),m=ed.getMonth()-jd.getMonth(),d=ed.getDate()-jd.getDate(); if(d<0){m--;d+=new Date(ed.getFullYear(),ed.getMonth(),0).getDate();} if(m<0){y--;m+=12;} return {years:Math.max(0,y),months:Math.max(0,m),days:Math.max(0,d)}; };
  const getNotice = (j: string, e: string) => { const t=calcTenure(j,e),m=t.years*12+t.months; if(m<3)return 0; if(m<12)return 10; if(m<36)return 20; return 30; };
  const calcAnnual = (t:{years:number;months:number}) => { const m=t.years*12+t.months; if(m<6)return 0; if(m<12)return 3; if(m<24)return 7; if(m<36)return 10; if(m<60)return 14; if(m<120)return 15; return Math.min(30,15+Math.floor((m-120)/12)); };
  const calcJobSearch = (n: number) => n===0?0:Math.ceil(n/7)*2;
  const calcSeverance = (t:{years:number;months:number},s:number) => Math.min((t.years*12+t.months)/12*0.5*s,s*6);

  const doCalc = (j:string,l:string,isKnown:boolean) => {
    if(!j) return;
    const ref = l || new Date().toISOString().split('T')[0];
    const tenure = calcTenure(j, ref), notice = getNotice(j, ref), annual = calcAnnual(tenure);
    const jobSearch = calcJobSearch(notice), remaining = Math.max(0, annual - form.usedAnnualLeave);
    const daily = form.monthlySalary / 30, leaveComp = remaining * daily;
    const severance = form.isInvoluntary ? calcSeverance(tenure, form.monthlySalary) : 0;
    const noticeWage = form.isInvoluntary ? notice * daily : 0;
    const insured = form.insuredSalary || form.monthlySalary;
    const baseRate = 0.6;
    const dependentRate = Math.min(form.dependents * 0.1, 0.2);
    const totalRate = baseRate + dependentRate;
    const monthlyUnemployment = form.isInvoluntary && form.insuranceYears >= 1 ? Math.round(insured * totalRate) : 0;
    const unemploymentMonths = form.isOver45 || form.hasDisability ? 9 : 6;
    const totalUnemployment = monthlyUnemployment * unemploymentMonths;
    const trainingAllowance = monthlyUnemployment;
    const earlyBonus = Math.round(monthlyUnemployment * (unemploymentMonths - 1) * 0.5);
    const healthSubsidy = form.isInvoluntary ? unemploymentMonths : 0;
    const totalGovBenefit = totalUnemployment;
    const baseCalc = { tenure, noticeRequired: notice, annualLeave: annual, jobSearchLeave: jobSearch, remainingLeave: remaining, leaveCompensation: leaveComp, severancePay: severance, noticeWage, unemploymentBenefit: monthlyUnemployment, unemploymentMonths, trainingAllowance, earlyEmploymentBonus: earlyBonus, healthInsuranceSubsidy: healthSubsidy, totalGovernmentBenefit: totalGovBenefit };
    if (isKnown && l) {
      const d = new Date(l); d.setDate(d.getDate() - notice);
      setCalc({ ...baseCalc, deadlineToResign: d.toISOString().split('T')[0], earliestLeaveDate: '' });
    } else {
      const d = new Date(ref); d.setDate(d.getDate() + notice);
      setCalc({ ...baseCalc, deadlineToResign: '', earliestLeaveDate: d.toISOString().split('T')[0] });
    }
  };

  const copy = (t: string, id: string) => { navigator.clipboard.writeText(t); setCopiedId(id); setTimeout(() => setCopiedId(null), 2000); };
  const reset = () => { if(confirm('ç¢ºå®šé‡æ–°é–‹å§‹ï¼Ÿ')) { localStorage.removeItem('resignV3'); location.reload(); } };
  const getLeaveDate = () => dateMode === 'known' ? form.leaveDate : (calc.earliestLeaveDate || new Date().toISOString().split('T')[0]);
  const updateForm = <K extends keyof typeof form>(key: K, value: typeof form[K]) => setForm(prev => ({ ...prev, [key]: value }));

  const exportCSV = (items: ChecklistItem[]) => {
    const rows = [['é …ç›®','åˆ†é¡','å„ªå…ˆåº¦','å‚™è¨»','ç‹€æ…‹'], ...items.map(i => [i.text, i.category, i.priority==='must'?'å¿…åš':i.priority==='should'?'å»ºè­°':'å¯é¸', i.note||'', i.checked?'âœ“':''])];
    const csv = '\uFEFF' + rows.map(r => r.map(c => `"${c}"`).join(',')).join('\n');
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'é›¢è·æ¸…å–®.csv'; a.click();
  };

  const exportHTML = (items: ChecklistItem[]) => {
    const cats = [...new Set(items.map(i => i.category))];
    const html = `<!DOCTYPE html><html lang="zh-TW"><head><meta charset="UTF-8"><title>é›¢è·æ¸…å–®</title><style>body{font-family:sans-serif;max-width:800px;margin:40px auto;padding:20px}h1{color:#6B8CAE}h2{margin-top:30px}.item{padding:8px 0;border-bottom:1px solid #eee;display:flex;gap:10px}.cb{width:18px;height:18px;border:2px solid #6B8CAE;border-radius:4px}.checked{background:#6B8CAE}.note{font-size:12px;color:#888}</style></head><body><h1>ğŸ“‹ é›¢è·äº¤æ¥æ¸…å–®</h1><p>ç”¢ç”Ÿæ—¥æœŸï¼š${new Date().toLocaleDateString('zh-TW')}</p>${cats.map(c=>`<h2>${c}</h2>${items.filter(i=>i.category===c).map(i=>`<div class="item"><div class="cb ${i.checked?'checked':''}"></div><div><div>${i.text}</div>${i.note?`<div class="note">ğŸ’¡ ${i.note}</div>`:''}</div></div>`).join('')}`).join('')}</body></html>`;
    const blob = new Blob([html], { type: 'text/html;charset=utf-8;' });
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'é›¢è·æ¸…å–®.html'; a.click();
  };

  const reasonMap: Record<string,string> = { career:'è·æ¶¯ç™¼å±•', family:'å®¶åº­å› ç´ ', health:'å¥åº·å› ç´ ', study:'é€²ä¿®å­¸ç¿’', relocation:'æ¬é·é€šå‹¤', other:'å€‹äººå› ç´ ' };
  const getReasonText = () => form.reasons.length === 0 ? 'å€‹äººç”Ÿæ¶¯è¦åŠƒ' : form.reasons.map(r => r === 'other' ? (form.reasonOther || 'å€‹äººå› ç´ ') : reasonMap[r]).join('ã€');
  const genLetter = () => { const ld = getLeaveDate(); const ldStr = ld ? new Date(ld).toLocaleDateString('zh-TW') : 'ï¼ˆå¾…å®šï¼‰'; if (form.tone === 'formal') return `${form.supervisorName || 'ä¸»ç®¡'}éˆé‘’ï¼š\n\næœ¬äºº${form.employeeName || ''}å› ${getReasonText()}ï¼Œæ“¬æ–¼ ${ldStr} é›¢è·ã€‚\n\n${form.gratitude || 'åœ¨è·æœŸé–“æ‰¿è’™æŒ‡å°ï¼Œè¬¹è‡´è¬å¿±ã€‚'}${form.hasHandover ? '\n\né›¢è·å‰å°‡å®Œæˆå·¥ä½œäº¤æ¥ï¼Œç¢ºä¿æ¥­å‹™é †åˆ©éŠœæ¥ã€‚' : ''}\n\næ•¬è«‹æ ¸å‡†ã€‚\n\næ­¤è‡´\n${form.company || 'å…¬å¸'}${form.department ? ' ' + form.department : ''}\n\n${form.employeeName || 'å“¡å·¥'}\n${new Date().toLocaleDateString('zh-TW')}`; if (form.tone === 'simple') return `${form.supervisorName || 'ä¸»ç®¡'}æ‚¨å¥½ï¼Œ\n\nå› ${getReasonText()}ï¼Œæˆ‘é è¨ˆ ${ldStr} é›¢è·ã€‚${form.hasHandover ? 'æœƒå®Œæˆäº¤æ¥ã€‚' : ''}\n\n${form.gratitude || 'è¬è¬é€™æ®µæ™‚é–“çš„ç…§é¡§ã€‚'}\n\n${form.employeeName || ''}`; return `${form.supervisorName || 'ä¸»ç®¡'}æ‚¨å¥½ï¼š\n\nç¶“éæ…é‡è€ƒæ…®ï¼Œå› ${getReasonText()}ï¼Œæˆ‘æ±ºå®šé›¢é–‹ç›®å‰çš„è·ä½ã€‚\n\né è¨ˆæœ€å¾Œå·¥ä½œæ—¥ç‚º ${ldStr}ã€‚\n\n${form.gratitude || 'æ„Ÿè¬æ‚¨é€™æ®µæ™‚é–“çš„æŒ‡å°èˆ‡ç…§é¡§ï¼Œè®“æˆ‘å­¸ç¿’æˆé•·å¾ˆå¤šã€‚'}${form.hasHandover ? '\n\nåœ¨é›¢è·å‰ï¼Œæˆ‘æœƒç¢ºå¯¦å®Œæˆæ‰‹é‚Šå·¥ä½œçš„äº¤æ¥ï¼Œè®“å¾ŒçºŒæ¥­å‹™èƒ½é †åˆ©é€²è¡Œã€‚' : ''}\n\nå†æ¬¡æ„Ÿè¬ï¼Œç¥åœ˜éšŠé †åˆ©ï¼\n\n${form.employeeName || ''}`; };
  const genSupervisor = () => `${form.supervisorName || 'ä¸»ç®¡'}æ‚¨å¥½ï¼š\n\næœ‰ä»¶äº‹æƒ³ç•¶é¢å‘æ‚¨å ±å‘Šï¼Œæƒ³è·Ÿæ‚¨ç´„å€‹æ™‚é–“è«‡è«‡ã€‚\n\nè«‹å•é€™é€±ä»€éº¼æ™‚å€™æ–¹ä¾¿ï¼Ÿ\n\n${form.employeeName || ''}`;
  const genHR = () => `äººè³‡åŒä»æ‚¨å¥½ï¼š\n\næˆ‘æ˜¯${form.department ? form.department + 'çš„' : ''}${form.employeeName || 'å“¡å·¥'}ï¼Œå·²å‘ä¸»ç®¡æå‡ºé›¢è·ç”³è«‹ã€‚\n\né è¨ˆæœ€å¾Œå·¥ä½œæ—¥ï¼š${getLeaveDate() ? new Date(getLeaveDate()).toLocaleDateString('zh-TW') : 'ï¼ˆå¾…å®šï¼‰'}\n\nç…©è«‹å”åŠ©å¾ŒçºŒé›¢è·æ‰‹çºŒï¼Œè¬è¬ï¼\n\n${form.employeeName || ''}`;
  const genColleague = () => `å„ä½åŒäº‹ï¼š\n\nåœ¨é€™é‚Šè·Ÿå¤§å®¶èªªè²å†è¦‹ï¼\n\n${calc.tenure.years > 0 || calc.tenure.months > 0 ? `é€™${calc.tenure.years > 0 ? calc.tenure.years + 'å¹´' : ''}${calc.tenure.months > 0 ? calc.tenure.months + 'å€‹æœˆ' : ''}` : 'é€™æ®µæ™‚é–“'}ï¼Œæ„Ÿè¬å¤§å®¶çš„ç…§é¡§èˆ‡åˆä½œã€‚\n\næˆ‘çš„æœ€å¾Œå·¥ä½œæ—¥æ˜¯ ${getLeaveDate() ? new Date(getLeaveDate()).toLocaleDateString('zh-TW') : 'ï¼ˆå¾…å®šï¼‰'}ã€‚\n\nå¸Œæœ›æœªä¾†é‚„æœ‰æ©Ÿæœƒå†è¦‹ï¼\n\nç¥å¤§å®¶å·¥ä½œé †åˆ© ğŸ™‚\n\n${form.employeeName || ''}`;
  const genVendor = () => `æ‚¨å¥½ï¼š\n\næˆ‘æ˜¯${form.company || 'å…¬å¸'}${form.department ? form.department : ''}çš„${form.employeeName || 'çª—å£'}ã€‚\n\nå› è·å‹™ç•°å‹•ï¼Œæˆ‘å°‡æ–¼ ${getLeaveDate() ? new Date(getLeaveDate()).toLocaleDateString('zh-TW') : 'è¿‘æœŸ'} é›¢è·ã€‚\n\nå¾ŒçºŒæ¥­å‹™å°‡ç”±åŒäº‹æ¥æ‰‹ï¼Œå±Šæ™‚æœƒå†é€šçŸ¥æ–°çª—å£è¯ç¹«æ–¹å¼ã€‚\n\næ„Ÿè¬æ‚¨ä¸€ç›´ä»¥ä¾†çš„é…åˆï¼\n\n${form.employeeName || ''}`;
  const genJobSearch = () => `ä¸»æ—¨ï¼šè¬€è·å‡ç”³è«‹\n\n${form.supervisorName || 'ä¸»ç®¡'}æ‚¨å¥½ï¼š\n\nä¾ã€Šå‹åŸºæ³•ã€‹ç¬¬16æ¢ç¬¬2é …ï¼Œæ–¼é å‘ŠæœŸé–“ç”³è«‹è¬€è·å‡ã€‚\n\nç”³è«‹å¤©æ•¸ï¼š${calc.jobSearchLeave} å¤©ï¼ˆé å‘ŠæœŸæ¯é€±2æ—¥ï¼‰\né è¨ˆä½¿ç”¨æ—¥æœŸï¼šï¼¿ï¼¿ï¼¿ï¼¿\n\næ‡‡è«‹æ ¸å‡†ï¼Œè¬è¬ï¼\n\n${form.employeeName || ''}`;
  const genLinkedIn = () => `ã€æ–°çš„æ—…ç¨‹ã€‘\n\nç¶“é ${calc.tenure.years>0?calc.tenure.years+' å¹´':''}${calc.tenure.months>0?calc.tenure.months+' å€‹æœˆ':''}ï¼Œæˆ‘å³å°‡é›¢é–‹ ${form.company||'ç¾è·'}ï¼Œå±•é–‹ä¸‹ä¸€ç¯‡ç« ã€‚\n\næ„Ÿè¬æ‰€æœ‰ä¸€èµ·å¥®é¬¥çš„å¤¥ä¼´å€‘ï¼\n\n#è·æ¶¯ #æ„Ÿè¬ #æ–°é–‹å§‹`;
  const genRef = () => `${form.supervisorName||'ä¸»ç®¡'} æ‚¨å¥½ï¼š\n\nåœ¨æˆ‘é›¢é–‹å‰ï¼Œæƒ³è«‹æ•™ä¸€ä»¶äº‹ã€‚\n\né€™æ®µæ™‚é–“åœ¨æ‚¨å¸¶é ˜ä¸‹å­¸åˆ°å¾ˆå¤šï¼Œä¸çŸ¥æ˜¯å¦æ–¹ä¾¿åœ¨ LinkedIn ä¸Šçµ¦æˆ‘ä¸€æ®µæ¨è–¦ï¼Ÿ\n\né€™å°æˆ‘è·æ¶¯ç™¼å±•å¾ˆæœ‰å¹«åŠ©ã€‚\n\nå¦‚æœä¸æ–¹ä¾¿ï¼Œå®Œå…¨æ²’é—œä¿‚ï¼\n\nè¬è¬ï¼\n${form.employeeName||''}`;


  // PAGES
  if(stage==='welcome') return <Page><div className="text-center space-y-4 py-6"><h1 className="text-3xl sm:text-4xl font-bold text-[#6B8CAE]">é›¢è·å…¨èƒ½å°èˆªå¹«æ‰‹</h1><p className="text-lg text-gray-600">æ–°çš„é–‹å§‹ï¼Œå¾æº«æš–çš„å‘Šåˆ¥é–‹å§‹ âœ¨</p><div className="bg-gradient-to-r from-[#FFD97D]/20 to-[#FFB6A3]/20 rounded-2xl p-4"><p className="text-[#6B8CAE]">æ¯ä¸€æ®µæ—…ç¨‹éƒ½æœ‰çµ‚é»ã€‚<br/>è®“æˆ‘å€‘ä¸€èµ·å¥½å¥½è¦åŠƒé€™å€‹è½‰è®Šã€‚</p></div><div className="bg-white rounded-2xl p-4 shadow-md text-left"><h3 className="font-bold text-gray-800 mb-2">åŠŸèƒ½ï¼š</h3><ul className="space-y-1 text-sm text-gray-600"><li>âœ“ è¨ˆç®—é å‘ŠæœŸã€ç‰¹ä¼‘ã€è³‡é£è²»</li><li>âœ“ ç¢ºèªæ³•å¾‹æ¬Šç›Š</li><li>âœ“ é›¢è·ä¿¡èˆ‡Emailç¯„æœ¬</li><li>âœ“ å®Œæ•´äº¤æ¥æ¸…å–®ï¼ˆå¯è¼¸å‡ºï¼‰</li><li>âœ“ æ•¸ä½å®‰å…¨æŒ‡å—</li></ul></div><button onClick={()=>setStage('join-date')} className="w-full bg-[#6B8CAE] text-white py-3 rounded-full font-medium">é–‹å§‹è¦åŠƒ ğŸš€</button><Privacy/></div></Page>;

  if(stage==='join-date') return <Page><Progress n={1} t={10}/><Enc text="ğŸŒ± æ”¹è®Šéœ€è¦å‹‡æ°£ï¼Œä½ å·²ç¶“è¸å‡ºç¬¬ä¸€æ­¥ã€‚"/><div className="bg-white rounded-xl p-4 shadow-lg"><label className="block text-lg font-bold text-gray-800 mb-1">åˆ°è·æ—¥æœŸï¼Ÿ</label><p className="text-xs text-gray-500 mb-3">å¤§æ¦‚æ—¥æœŸå³å¯</p><input type="date" value={form.joinDate} onChange={e=>updateForm('joinDate',e.target.value)} className="w-full px-3 py-2.5 border-2 border-[#6B8CAE]/30 rounded-xl focus:outline-none focus:border-[#6B8CAE]"/></div><Legal>ä¾ã€Šå‹åŸºæ³•ã€‹Â§84-2ï¼Œå¹´è³‡è‡ªå—åƒ±æ—¥èµ·ç®—ã€‚</Legal><div className="flex gap-3"><Btn onClick={()=>setStage('welcome')} variant="secondary"><ChevronLeft className="w-4 h-4"/></Btn><Btn onClick={()=>setStage('leave-date')} disabled={!form.joinDate}>ä¸‹ä¸€æ­¥ <ChevronRight className="w-4 h-4"/></Btn></div><Footer/></Page>;

  if(stage==='leave-date') { const ct=calcTenure(form.joinDate,new Date().toISOString().split('T')[0]); return <Page><Progress n={2} t={10}/><Enc text="ğŸ—“ï¸ çµ¦è‡ªå·±å……è¶³çš„æ™‚é–“èªªå†è¦‹ã€‚"/><div className="bg-white rounded-xl p-4 shadow-lg space-y-4"><div><div className="text-sm text-gray-500 mb-1">åˆ°è·æ—¥æœŸ</div><div className="text-xl font-bold text-[#6B8CAE] bg-[#6B8CAE]/10 rounded-xl p-3 text-center">{new Date(form.joinDate).toLocaleDateString('zh-TW')}</div><div className="text-center mt-1 text-sm text-gray-600">å¹´è³‡ç´„ {ct.years} å¹´ {ct.months} å€‹æœˆ</div></div><div className="border-t pt-4"><h3 className="font-bold text-gray-800 mb-3">æ±ºå®šé›¢è·æ—¥æœŸäº†å—ï¼Ÿ</h3><div className="space-y-2"><label className={`block p-3 border-2 rounded-xl cursor-pointer ${dateMode==='known'?'border-[#6B8CAE] bg-[#6B8CAE]/5':'border-gray-200'}`}><div className="flex items-start gap-3"><input type="radio" checked={dateMode==='known'} onChange={()=>setDateMode('known')} className="mt-1"/><div className="flex-1"><div className="font-bold text-sm">âœ“ æ˜¯ï¼Œå·²æ±ºå®šæœ€å¾Œä¸Šç­æ—¥</div><div className="text-xs text-gray-500 mb-2">å‘Šè¨´ä½ æœ€æ™šä½•æ™‚æé›¢è·</div>{dateMode==='known'&&<input type="date" value={form.leaveDate} onChange={e=>updateForm('leaveDate',e.target.value)} min={form.joinDate} className="w-full px-3 py-2 border-2 border-[#6B8CAE]/30 rounded-xl text-sm"/>}</div></div></label><label className={`block p-3 border-2 rounded-xl cursor-pointer ${dateMode==='unknown'?'border-[#6B8CAE] bg-[#6B8CAE]/5':'border-gray-200'}`}><div className="flex items-start gap-3"><input type="radio" checked={dateMode==='unknown'} onChange={()=>setDateMode('unknown')} className="mt-1"/><div className="flex-1"><div className="font-bold text-sm">ğŸ¤” æƒ³æé›¢è·ä½†ä¸ç¢ºå®šæ™‚é–“</div><div className="text-xs text-gray-500 mb-2">å‘Šè¨´ä½ æœ€æ—©ä½•æ™‚å¯é›¢è·</div>{dateMode==='unknown'&&<><input type="date" value={form.noticeDate} onChange={e=>updateForm('noticeDate',e.target.value)} min={new Date().toISOString().split('T')[0]} className="w-full px-3 py-2 border-2 border-[#6B8CAE]/30 rounded-xl text-sm"/><p className="text-xs text-gray-400 mt-1">å¯ä¸å¡«ï¼Œé è¨­ä»Šå¤©</p></>}</div></div></label></div></div></div><div className="flex gap-3"><Btn onClick={()=>setStage('join-date')} variant="secondary"><ChevronLeft className="w-4 h-4"/> ä¸Šä¸€æ­¥</Btn><Btn onClick={()=>{const nd=form.noticeDate||new Date().toISOString().split('T')[0];if(dateMode==='unknown'&&!form.noticeDate)updateForm('noticeDate',nd);doCalc(form.joinDate,dateMode==='known'?form.leaveDate:nd,dateMode==='known');setStage('salary-info');}} disabled={dateMode==='known'&&!form.leaveDate}>ä¸‹ä¸€æ­¥ <ChevronRight className="w-4 h-4"/></Btn></div><Footer/></Page>; }

  if(stage==='salary-info') return <Page><Progress n={3} t={10}/><Enc text="ğŸ’° å¡«å¯«è–ªè³‡ï¼Œç²¾ç®—æ¬Šç›Š"/><div className="bg-white rounded-xl p-4 shadow-lg space-y-4"><p className="text-xs text-gray-500">é¸å¡«ï¼Œç”¨æ–¼è¨ˆç®—ç‰¹ä¼‘çµç®—ç­‰</p><div><label className="block text-sm font-medium text-gray-700 mb-1">æœˆè–ªï¼ˆå¯¦é ˜ï¼‰</label><div className="flex items-center gap-2"><span className="text-gray-500">$</span><input type="text" inputMode="numeric" pattern="[0-9]*" value={form.monthlySalary===0?'':form.monthlySalary} onChange={e=>updateForm('monthlySalary',e.target.value===''?0:Number(e.target.value.replace(/\D/g,'')))} placeholder="ä¾‹ï¼š45000" className="flex-1 px-3 py-2 border rounded-lg text-sm"/></div></div><div><label className="block text-sm font-medium text-gray-700 mb-1">å·²ä½¿ç”¨ç‰¹ä¼‘</label><input type="text" inputMode="numeric" pattern="[0-9]*" value={form.usedAnnualLeave===0?'':form.usedAnnualLeave} onChange={e=>updateForm('usedAnnualLeave',e.target.value===''?0:Number(e.target.value.replace(/\D/g,'')))} placeholder="ä¾‹ï¼š5" className="w-full px-3 py-2 border rounded-lg text-sm"/></div><div className="border-t pt-4"><label className="flex items-center gap-2 cursor-pointer"><input type="checkbox" checked={form.isInvoluntary} onChange={e=>updateForm('isInvoluntary',e.target.checked)} className="w-4 h-4"/><span className="text-sm text-gray-700">éè‡ªé¡˜é›¢è·ï¼ˆè³‡é£ã€è£å“¡ï¼‰</span></label>{form.isInvoluntary&&<div className="mt-3 space-y-3"><div><label className="block text-sm font-medium text-gray-700 mb-1">é›¢è·ä»£ç¢¼</label><select value={form.severanceReason} onChange={e=>updateForm('severanceReason',e.target.value)} className="w-full px-3 py-2 border rounded-lg text-sm"><option value="">è«‹é¸æ“‡</option><option value="11-1">11-1 æ­‡æ¥­</option><option value="11-2">11-2 è½‰è®“</option><option value="11-3">11-3 è™§æ</option><option value="11-4">11-4 æ¥­å‹™ç·Šç¸®</option><option value="14">14 é›‡ä¸»é•æ³•</option></select><p className="text-xs text-gray-500 mt-1">ç¢ºèªé›¢è·è­‰æ˜ä»£ç¢¼æ­£ç¢ºæ‰èƒ½ç”³è«‹å¤±æ¥­çµ¦ä»˜</p></div><div className="bg-blue-50 rounded-lg p-3"><p className="text-xs font-medium text-blue-800 mb-2">ğŸ“‹ æ”¿åºœå¤±æ¥­è£œåŠ©è¨ˆç®—ï¼ˆé¸å¡«ï¼‰</p><div className="space-y-2"><div><label className="block text-xs text-gray-600 mb-1">æœˆæŠ•ä¿è–ªè³‡ï¼ˆæŸ¥å‹ä¿æ˜ç´°ï¼‰</label><div className="flex items-center gap-2"><span className="text-gray-400 text-sm">$</span><input type="text" inputMode="numeric" value={form.insuredSalary===0?'':form.insuredSalary} onChange={e=>updateForm('insuredSalary',e.target.value===''?0:Number(e.target.value.replace(/\D/g,'')))} placeholder="ä¸å¡«å‰‡ä»¥æœˆè–ªè¨ˆç®—" className="flex-1 px-2 py-1.5 border rounded text-sm"/></div></div><div><label className="block text-xs text-gray-600 mb-1">å°±ä¿å¹´è³‡ï¼ˆ3å¹´å…§éœ€æ»¿1å¹´ï¼‰</label><select value={form.insuranceYears} onChange={e=>updateForm('insuranceYears',Number(e.target.value))} className="w-full px-2 py-1.5 border rounded text-sm"><option value={0}>æœªæ»¿1å¹´</option><option value={1}>1å¹´ä»¥ä¸Š</option></select></div><div><label className="block text-xs text-gray-600 mb-1">æ‰¶é¤Šäººæ•¸ï¼ˆç„¡å·¥ä½œæ”¶å…¥çœ·å±¬ï¼‰</label><select value={form.dependents} onChange={e=>updateForm('dependents',Number(e.target.value))} className="w-full px-2 py-1.5 border rounded text-sm"><option value={0}>0äºº</option><option value={1}>1äººï¼ˆ+10%ï¼‰</option><option value={2}>2äººä»¥ä¸Šï¼ˆ+20%ï¼‰</option></select></div><div className="flex gap-4"><label className="flex items-center gap-1.5 text-xs"><input type="checkbox" checked={form.isOver45} onChange={e=>updateForm('isOver45',e.target.checked)} className="w-3.5 h-3.5"/>å¹´æ»¿45æ­²</label><label className="flex items-center gap-1.5 text-xs"><input type="checkbox" checked={form.hasDisability} onChange={e=>updateForm('hasDisability',e.target.checked)} className="w-3.5 h-3.5"/>èº«å¿ƒéšœç¤™</label></div></div></div></div>}</div></div>{form.isInvoluntary&&<Warn><strong>éè‡ªé¡˜é›¢è·æ³¨æ„ï¼š</strong>ç¢ºèªé›¢è·è­‰æ˜ä»£ç¢¼ç¬¦åˆå‹åŸºæ³•Â§11æˆ–Â§14</Warn>}<div className="flex gap-3"><Btn onClick={()=>setStage('leave-date')} variant="secondary"><ChevronLeft className="w-4 h-4"/> ä¸Šä¸€æ­¥</Btn><Btn onClick={()=>{doCalc(form.joinDate,dateMode==='known'?form.leaveDate:form.noticeDate,dateMode==='known');setStage('result');}}>è¨ˆç®— <ChevronRight className="w-4 h-4"/></Btn></div><Footer/></Page>;

  if(stage==='result') return <Page><Progress n={4} t={10}/><Enc text="ğŸ“Š äº†è§£è¦å‰‡ï¼Œä¿è­·æ¬Šç›Šï¼"/><div className="bg-white rounded-xl p-4 shadow-lg space-y-4"><div className="text-center"><div className="text-xs text-gray-500">å¹´è³‡</div><div className="text-3xl font-bold text-[#6B8CAE]">{calc.tenure.years} å¹´ {calc.tenure.months} å€‹æœˆ</div></div><div className="border-t pt-4 space-y-2"><div className="flex justify-between items-center bg-[#6B8CAE]/5 rounded-xl p-3"><span className="text-sm">æ³•å®šé å‘ŠæœŸ</span><span className="text-2xl font-bold text-[#6B8CAE]">{calc.noticeRequired===0?'ä¸éœ€é å‘Š':`${calc.noticeRequired} å¤©`}</span></div>{dateMode==='known'&&calc.noticeRequired>0&&<><div className="flex justify-between items-center bg-[#FFB6A3]/10 rounded-xl p-3"><span className="text-sm">âš ï¸ æœ€æ™šæé›¢è·</span><span className="text-xl font-bold text-[#e07c5c]">{new Date(calc.deadlineToResign).toLocaleDateString('zh-TW')}</span></div><div className="flex justify-between items-center bg-[#6B8CAE]/5 rounded-xl p-3"><span className="text-sm">æœ€å¾Œä¸Šç­æ—¥</span><span className="text-xl font-bold text-[#6B8CAE]">{new Date(form.leaveDate).toLocaleDateString('zh-TW')}</span></div></>}{dateMode==='unknown'&&<><div className="flex justify-between items-center bg-[#6B8CAE]/5 rounded-xl p-3"><span className="text-sm">æé›¢è·æ—¥</span><span className="text-xl font-bold text-[#6B8CAE]">{new Date(form.noticeDate||new Date()).toLocaleDateString('zh-TW')}</span></div>{calc.noticeRequired>0&&<div className="flex justify-between items-center bg-[#FFB6A3]/10 rounded-xl p-3"><span className="text-sm">ğŸ“… æœ€æ—©é›¢è·æ—¥</span><span className="text-xl font-bold text-[#e07c5c]">{new Date(calc.earliestLeaveDate).toLocaleDateString('zh-TW')}</span></div>}</>}</div>{calc.noticeRequired>0&&<div className="border-t pt-4"><div className="flex justify-between items-center bg-blue-50 rounded-xl p-3"><div><span className="text-sm font-medium">ğŸ” è¬€è·å‡</span><p className="text-xs text-gray-500">é å‘ŠæœŸæ¯é€±2æ—¥æœ‰è–ª</p></div><span className="text-xl font-bold text-blue-600">{calc.jobSearchLeave} å¤©</span></div></div>}<div className="border-t pt-4 space-y-2"><h4 className="font-medium text-sm text-gray-700">ğŸ–ï¸ ç‰¹ä¼‘çµç®—</h4><div className="grid grid-cols-2 gap-2 text-sm"><div className="bg-gray-50 rounded-lg p-2"><div className="text-gray-500 text-xs">æ‡‰æœ‰</div><div className="font-bold text-[#6B8CAE]">{calc.annualLeave} å¤©</div></div><div className="bg-gray-50 rounded-lg p-2"><div className="text-gray-500 text-xs">å·²ç”¨</div><div className="font-bold">{form.usedAnnualLeave} å¤©</div></div><div className="bg-green-50 rounded-lg p-2"><div className="text-gray-500 text-xs">å‰©é¤˜</div><div className="font-bold text-green-600">{calc.remainingLeave} å¤©</div></div>{form.monthlySalary>0&&<div className="bg-green-50 rounded-lg p-2"><div className="text-gray-500 text-xs">æŠ˜ç®—</div><div className="font-bold text-green-600">${Math.round(calc.leaveCompensation).toLocaleString()}</div></div>}</div></div>{form.isInvoluntary&&form.monthlySalary>0&&<div className="border-t pt-4 space-y-2"><h4 className="font-medium text-sm text-gray-700">ğŸ’° è³‡é£è²»</h4><div className="grid grid-cols-2 gap-2 text-sm"><div className="bg-amber-50 rounded-lg p-2"><div className="text-gray-500 text-xs">é å‘Šå·¥è³‡</div><div className="font-bold text-amber-600">${Math.round(calc.noticeWage).toLocaleString()}</div></div><div className="bg-amber-50 rounded-lg p-2"><div className="text-gray-500 text-xs">è³‡é£è²»</div><div className="font-bold text-amber-600">${Math.round(calc.severancePay).toLocaleString()}</div></div></div></div>}</div><Legal>é å‘ŠæœŸï¼šæœªæ»¿3æœˆä¸éœ€ã€3æœˆ~1å¹´10å¤©ã€1~3å¹´20å¤©ã€3å¹´ä»¥ä¸Š30å¤©</Legal><div className="flex gap-3"><Btn onClick={()=>setStage('salary-info')} variant="secondary"><ChevronLeft className="w-4 h-4"/> ä¸Šä¸€æ­¥</Btn><Btn onClick={()=>setStage('menu')}>ç¹¼çºŒ <ChevronRight className="w-4 h-4"/></Btn></div><Footer/></Page>;

  if(stage==='menu') return <Page><Enc text="ğŸ“‹ é¸æ“‡éœ€è¦çš„åŠŸèƒ½"/><div className="space-y-3"><Menu icon={<FileIcon/>} title="é›¢è·ä¿¡ç”Ÿæˆå™¨" desc="æ­£å¼/è¦ªåˆ‡/ç°¡æ½”ä¸‰ç¨®é¢¨æ ¼" onClick={()=>setStage('letter-info')}/><Menu icon={<CopyIcon/>} title="Emailç¯„æœ¬" desc="ä¸»ç®¡ã€äººè³‡ã€åŒäº‹ã€å» å•†ã€æ¨è–¦ä¿¡" onClick={()=>setStage('letter-result')}/><Menu icon={<CheckIcon/>} title="äº¤æ¥æ¸…å–®" desc="30é …å®Œæ•´æ¸…å–®ï¼Œå¯è¼¸å‡ºWord/Excel" onClick={()=>setStage('checklist')} badge="å¯è¼¸å‡º"/><Menu icon={<CalcIcon/>} title="è¬€è·å‡ç”³è«‹" desc="è‡ªå‹•è¨ˆç®—å¤©æ•¸ï¼Œç”¢ç”Ÿç”³è«‹ç¯„æœ¬" onClick={()=>setStage('job-search')}/><Menu icon={<ShieldIcon/>} title="æ³•å¾‹æ¬Šç›Š" desc="ç‰¹ä¼‘ã€è³‡é£è²»ã€å‹å¥ä¿ã€ç«¶æ¥­æ¢æ¬¾" onClick={()=>setStage('rights')} badge="é‡è¦"/><Menu icon={<AlertIcon/>} title="æ•¸ä½å®‰å…¨" desc="å¸³è™Ÿæ›ç¶ã€ä½œå“é›†è„«æ•ã€è¶³è·¡æ¸…é™¤" onClick={()=>setStage('digital')}/></div><div className="flex gap-3 mt-4"><Btn onClick={()=>setStage('result')} variant="secondary"><ChevronLeft className="w-4 h-4"/> è¨ˆç®—çµæœ</Btn><Btn onClick={()=>setStage('complete')}>å®Œæˆ ğŸ‰</Btn></div><Footer/></Page>;

  if(stage==='letter-info') { const reasons=[{id:'career',l:'è·æ¶¯ç™¼å±•'},{id:'family',l:'å®¶åº­å› ç´ '},{id:'health',l:'å¥åº·å› ç´ '},{id:'study',l:'é€²ä¿®å­¸ç¿’'},{id:'relocation',l:'æ¬é·é€šå‹¤'},{id:'other',l:'å…¶ä»–'}]; const toggle=(id:string)=>setForm(p=>({...p,reasons:p.reasons.includes(id)?p.reasons.filter(r=>r!==id):[...p.reasons,id]})); return <Page><Progress n={5} t={10}/><Enc text="âœï¸ å¡«å¯«è³‡è¨Šç”Ÿæˆé›¢è·ä¿¡"/><div className="bg-white rounded-xl p-4 shadow-lg space-y-3"><p className="text-xs text-gray-500">çš†ç‚ºé¸å¡«</p><div className="grid grid-cols-2 gap-2"><input placeholder="ä½ çš„å§“å" value={form.employeeName} onChange={e=>updateForm('employeeName',e.target.value)} className="px-3 py-2 border rounded-lg text-sm"/><input placeholder="ä¸»ç®¡ç¨±å‘¼" value={form.supervisorName} onChange={e=>updateForm('supervisorName',e.target.value)} className="px-3 py-2 border rounded-lg text-sm"/><input placeholder="å…¬å¸åç¨±" value={form.company} onChange={e=>updateForm('company',e.target.value)} className="px-3 py-2 border rounded-lg text-sm"/><input placeholder="éƒ¨é–€" value={form.department} onChange={e=>updateForm('department',e.target.value)} className="px-3 py-2 border rounded-lg text-sm"/><input placeholder="è·ç¨±" value={form.position} onChange={e=>updateForm('position',e.target.value)} className="col-span-2 px-3 py-2 border rounded-lg text-sm"/></div><div><label className="text-sm font-medium text-gray-700">é›¢è·åŸå› ï¼ˆå¯è¤‡é¸ï¼‰</label><div className="grid grid-cols-3 gap-1 mt-1">{reasons.map(r=><label key={r.id} className={`p-2 border rounded-lg text-xs cursor-pointer text-center ${form.reasons.includes(r.id)?'border-[#6B8CAE] bg-[#6B8CAE]/5':''}`}><input type="checkbox" checked={form.reasons.includes(r.id)} onChange={()=>toggle(r.id)} className="sr-only"/>{r.l}</label>)}</div>{form.reasons.includes('other')&&<input placeholder="èªªæ˜å…¶ä»–åŸå› " value={form.reasonOther} onChange={e=>updateForm('reasonOther',e.target.value)} className="w-full mt-2 px-3 py-2 border rounded-lg text-sm"/>}</div><div><label className="text-sm font-medium text-gray-700">èªæ°£</label><div className="flex gap-2 mt-1">{(['formal','friendly','simple'] as const).map(t=><label key={t} className={`flex-1 py-2 text-center text-sm rounded-full cursor-pointer border ${form.tone===t?'bg-[#6B8CAE] text-white border-[#6B8CAE]':'border-gray-200'}`}><input type="radio" checked={form.tone===t} onChange={()=>updateForm('tone',t)} className="sr-only"/>{{formal:'æ­£å¼',friendly:'è¦ªåˆ‡',simple:'ç°¡æ½”'}[t]}</label>)}</div></div><textarea placeholder="æ„Ÿè¬çš„è©±ï¼ˆé¸å¡«ï¼‰" value={form.gratitude} onChange={e=>updateForm('gratitude',e.target.value)} rows={2} className="w-full px-3 py-2 border rounded-lg text-sm resize-none"/><label className="flex items-center gap-2 text-sm"><input type="checkbox" checked={form.hasHandover} onChange={e=>updateForm('hasHandover',e.target.checked)}/>åŠ å…¥äº¤æ¥æ‰¿è«¾</label></div><div className="flex gap-3"><Btn onClick={()=>setStage('menu')} variant="secondary"><ChevronLeft className="w-4 h-4"/> è¿”å›</Btn><Btn onClick={()=>setStage('letter-result')}>ç”Ÿæˆ <ChevronRight className="w-4 h-4"/></Btn></div><Footer/></Page>; }

  if(stage==='letter-result') { const letter=genLetter(); return <Page><Progress n={6} t={10}/><Enc text="ğŸ“ é›¢è·æ–‡ä»¶æº–å‚™å¥½äº†ï¼"/><div className="bg-white rounded-xl p-4 shadow-lg"><div className="flex justify-between items-center mb-2"><h3 className="font-bold text-gray-800">é›¢è·ä¿¡</h3><CopyBtn text={letter} id="letter" copiedId={copiedId} onCopy={copy}/></div><pre className="whitespace-pre-wrap text-sm text-gray-700 bg-gray-50 rounded-lg p-3 font-sans max-h-48 overflow-y-auto">{letter}</pre></div><div className="bg-white rounded-xl p-4 shadow-lg space-y-3"><h3 className="font-bold text-gray-800">Emailç¯„æœ¬</h3>{[{t:'ğŸ“§ ç´„ä¸»ç®¡é¢è«‡',c:genSupervisor(),id:'s'},{t:'ğŸ“§ é€šçŸ¥äººè³‡',c:genHR(),id:'h'},{t:'ğŸ“§ å‘åŒäº‹é“åˆ¥',c:genColleague(),id:'c'},{t:'ğŸ“§ é€šçŸ¥å» å•†',c:genVendor(),id:'v'},{t:'ğŸ™ è«‹æ±‚æ¨è–¦',c:genRef(),id:'ref'},{t:'ğŸ’¼ LinkedInå‹•æ…‹',c:genLinkedIn(),id:'li'}].map(e=><div key={e.id} className="border rounded-lg p-2"><div className="flex justify-between items-center mb-1"><span className="text-sm font-medium">{e.t}</span><CopyBtn text={e.c} id={e.id} copiedId={copiedId} onCopy={copy}/></div><pre className="whitespace-pre-wrap text-xs text-gray-600 bg-gray-50 rounded p-2 font-sans max-h-32 overflow-y-auto">{e.c}</pre></div>)}</div><div className="flex gap-3"><Btn onClick={()=>setStage('letter-info')} variant="secondary"><ChevronLeft className="w-4 h-4"/> ä¿®æ”¹</Btn><Btn onClick={()=>setStage('menu')}>è¿”å› <ChevronRight className="w-4 h-4"/></Btn></div><Footer/></Page>; }

  if(stage==='job-search') { const req=genJobSearch(); return <Page><Enc text="ğŸ” è¬€è·å‡æ˜¯ä½ çš„æ³•å®šæ¬Šåˆ©ï¼"/><div className="bg-white rounded-xl p-4 shadow-lg space-y-4"><div className="flex justify-between items-center"><div><h3 className="font-bold text-gray-800">è¬€è·å‡å¤©æ•¸</h3><p className="text-xs text-gray-500">é å‘ŠæœŸæ¯é€±2æ—¥æœ‰è–ª</p></div><span className="text-3xl font-bold text-[#6B8CAE]">{calc.jobSearchLeave} å¤©</span></div><div><div className="flex justify-between items-center mb-2"><span className="text-sm font-medium">ç”³è«‹å–®ç¯„æœ¬</span><CopyBtn text={req} id="jsl" copiedId={copiedId} onCopy={copy}/></div><pre className="whitespace-pre-wrap text-xs text-gray-700 bg-gray-50 rounded-lg p-3 font-sans">{req}</pre></div></div><Legal>ã€Šå‹åŸºæ³•ã€‹Â§16-2ï¼šé å‘ŠæœŸé–“æ¯é€±å¯è«‹2æ—¥æœ‰è–ªå‡å¤–å‡ºè¬€è·</Legal><div className="flex gap-3"><Btn onClick={()=>setStage('menu')} variant="secondary"><ChevronLeft className="w-4 h-4"/> è¿”å›</Btn></div><Footer/></Page>; }

  if(stage==='checklist') { const cats=['æ³•å¾‹æ¬Šç›Š','å·¥ä½œäº¤æ¥','æ•¸ä½å®‰å…¨','ç‰©å“æ­¸é‚„','äººéš›é—œä¿‚']; const toggle=(id:string)=>setChecklist(p=>p.map(i=>i.id===id?{...i,checked:!i.checked}:i)); const done=checklist.filter(i=>i.checked).length; const unchecked=checklist.filter(i=>!i.checked); return <Page><Progress n={7} t={10}/><Enc text="âœ… ç¢ºä¿ä¸éºæ¼ï¼"/><div className="bg-white rounded-xl p-4 shadow-lg"><div className="flex justify-between items-center mb-2"><h3 className="font-bold text-gray-800">é›¢è·äº¤æ¥æ¸…å–®</h3><span className="text-sm text-[#6B8CAE]">{done}/{checklist.length}</span></div><div className="w-full h-2 bg-gray-200 rounded-full mb-4 overflow-hidden"><div className="h-full bg-gradient-to-r from-[#6B8CAE] to-[#FFD97D]" style={{width:`${(done/checklist.length)*100}%`}}/></div><div className="space-y-4 max-h-80 overflow-y-auto">{cats.map(cat=><div key={cat}><h4 className="text-xs font-bold text-[#6B8CAE] mb-2 sticky top-0 bg-white py-1">{cat}</h4><div className="space-y-1">{checklist.filter(i=>i.category===cat).map(i=><label key={i.id} className={`flex items-start gap-2 p-2 rounded-lg cursor-pointer ${i.checked?'bg-green-50':'hover:bg-gray-50'} ${i.priority==='must'?'border-l-2 border-red-400':i.priority==='should'?'border-l-2 border-amber-400':''}`}><input type="checkbox" checked={i.checked} onChange={()=>toggle(i.id)} className="w-4 h-4 mt-0.5 flex-shrink-0"/><div className="flex-1"><span className={`text-sm ${i.checked?'text-gray-400 line-through':''}`}>{i.text}</span>{i.note&&<p className="text-xs text-gray-400 mt-0.5">ğŸ’¡ {i.note}</p>}</div></label>)}</div></div>)}</div></div><div className="bg-white rounded-xl p-4 shadow-lg"><h3 className="font-bold text-gray-800 mb-3">ğŸ“¤ è¼¸å‡ºæœªå®Œæˆé …ç›®</h3><div className="grid grid-cols-2 gap-2"><button onClick={()=>exportCSV(unchecked)} className="flex items-center justify-center gap-2 p-3 border rounded-xl hover:bg-gray-50"><DownloadIcon className="w-4 h-4 text-green-600"/><span className="text-sm">Excel (CSV)</span></button><button onClick={()=>exportHTML(unchecked)} className="flex items-center justify-center gap-2 p-3 border rounded-xl hover:bg-gray-50"><DownloadIcon className="w-4 h-4 text-blue-600"/><span className="text-sm">Word (HTML)</span></button></div><p className="text-xs text-gray-500 mt-2 text-center">CSVå¯ç”¨Excel/Google Sheetsé–‹å•Ÿï¼ŒHTMLå¯ç”¨Wordé–‹å•Ÿ</p></div><div className="flex gap-3"><Btn onClick={()=>setStage('menu')} variant="secondary"><ChevronLeft className="w-4 h-4"/> è¿”å›</Btn><Btn onClick={()=>setStage('rights')}>ç¢ºèªæ¬Šç›Š <ChevronRight className="w-4 h-4"/></Btn></div><Footer/></Page>; }


  if(stage==='rights') return <Page><Progress n={8} t={10}/><Enc text="ğŸ’° ç¢ºèªä½ çš„æ¬Šç›Šï¼"/><div className="bg-white rounded-xl p-4 shadow-lg space-y-4"><h3 className="font-bold text-gray-800">æ³•å¾‹æ¬Šç›Šç¢ºèª</h3><div className="bg-[#6B8CAE]/5 rounded-xl p-3"><h4 className="font-medium text-sm mb-2">ğŸ–ï¸ ç‰¹ä¼‘çµç®—</h4><p className="text-sm">å‰©é¤˜ <strong className="text-[#6B8CAE]">{calc.remainingLeave} å¤©</strong></p>{form.monthlySalary>0&&<p className="text-sm">ç´„ <strong className="text-green-600">${Math.round(calc.leaveCompensation).toLocaleString()}</strong></p>}<p className="text-xs text-gray-500 mt-1">æœªä¼‘å®Œæ‡‰æŠ˜ç®—å·¥è³‡</p></div>{form.isInvoluntary&&<><div className="bg-amber-50 rounded-xl p-3 border-2 border-amber-200"><h4 className="font-bold text-sm mb-2 text-amber-800">ğŸ¢ å…¬å¸æ‡‰çµ¦ä»˜</h4><div className="space-y-2">{form.monthlySalary>0?<><div className="flex justify-between items-center"><span className="text-sm">è³‡é£è²»</span><span className="font-bold text-amber-700">${Math.round(calc.severancePay).toLocaleString()}</span></div><p className="text-xs text-gray-500">æ–°åˆ¶ï¼šå¹´è³‡Ã—0.5å€‹æœˆè–ªï¼Œæœ€é«˜6å€‹æœˆ</p>{calc.noticeWage>0&&<><div className="flex justify-between items-center border-t pt-2"><span className="text-sm">é å‘Šå·¥è³‡</span><span className="font-bold text-amber-700">${Math.round(calc.noticeWage).toLocaleString()}</span></div><p className="text-xs text-gray-500">å…¬å¸æœªæå‰é å‘Šæ™‚é ˆæ”¯ä»˜</p></>}<div className="border-t pt-2 mt-2"><div className="flex justify-between items-center"><span className="text-sm font-medium">å°è¨ˆ</span><span className="font-bold text-amber-800 text-lg">${Math.round(calc.severancePay+calc.noticeWage+calc.leaveCompensation).toLocaleString()}</span></div><p className="text-xs text-gray-400">å«ç‰¹ä¼‘æŠ˜ç®— ${Math.round(calc.leaveCompensation).toLocaleString()}</p></div></>:<p className="text-xs text-gray-500">è«‹å¡«å…¥æœˆè–ªä»¥è¨ˆç®—</p>}</div></div>{form.insuranceYears>=1&&<div className="bg-blue-50 rounded-xl p-3 border-2 border-blue-200"><h4 className="font-bold text-sm mb-2 text-blue-800">ğŸ›ï¸ æ”¿åºœå¤±æ¥­è£œåŠ©</h4>{(form.insuredSalary||form.monthlySalary)>0?<div className="space-y-2"><div className="flex justify-between items-center"><span className="text-sm">å¤±æ¥­çµ¦ä»˜ï¼ˆæ¯æœˆï¼‰</span><span className="font-bold text-blue-700">${calc.unemploymentBenefit.toLocaleString()}</span></div><p className="text-xs text-gray-500">æŠ•ä¿è–ªè³‡60%{form.dependents>0?`+æ‰¶é¤ŠåŠ çµ¦${form.dependents>=2?'20':'10'}%`:''} Ã— {calc.unemploymentMonths}å€‹æœˆ</p><div className="flex justify-between items-center"><span className="text-sm">æœ€é•·å¯é ˜</span><span className="font-bold text-blue-700">{calc.unemploymentMonths} å€‹æœˆ</span></div><p className="text-xs text-gray-500">{form.isOver45||form.hasDisability?'45æ­²ä»¥ä¸Šæˆ–èº«å¿ƒéšœç¤™è€…':'ä¸€èˆ¬å‹å·¥6å€‹æœˆ'}</p><div className="border-t pt-2 mt-2"><div className="flex justify-between items-center"><span className="text-sm font-medium">ç¸½è¨ˆå¯é ˜</span><span className="font-bold text-blue-800 text-lg">${(calc.unemploymentBenefit*calc.unemploymentMonths).toLocaleString()}</span></div></div><div className="bg-white/50 rounded-lg p-2 mt-2"><p className="text-xs text-gray-600"><strong>ğŸ“‹ å…¶ä»–è£œåŠ©ï¼š</strong></p><ul className="text-xs text-gray-500 mt-1 space-y-0.5"><li>â€¢ è·è¨“ç”Ÿæ´»æ´¥è²¼ï¼š${calc.trainingAllowance.toLocaleString()}/æœˆï¼ˆåƒåŠ è·è¨“æœŸé–“ï¼‰</li><li>â€¢ ææ—©å°±æ¥­çå‹µï¼šå‰©é¤˜æœˆä»½Ã—50%ä¸€æ¬¡ç™¼</li><li>â€¢ å¥ä¿è²»å…¨é¡è£œåŠ©ï¼šé ˜å¤±æ¥­çµ¦ä»˜æœŸé–“</li></ul></div></div>:<p className="text-xs text-gray-500">è«‹å¡«å…¥è–ªè³‡ä»¥è¨ˆç®—</p>}<p className="text-xs text-blue-600 mt-2">âš ï¸ éœ€å°±ä¿å¹´è³‡æ»¿1å¹´ä¸”å‘å°±æ¥­æœå‹™ç«™è¾¦ç†</p></div>}{form.insuranceYears<1&&<div className="bg-gray-100 rounded-xl p-3"><p className="text-xs text-gray-500">ğŸ’¡ å°±ä¿å¹´è³‡æœªæ»¿1å¹´ç„¡æ³•ç”³è«‹å¤±æ¥­çµ¦ä»˜ï¼Œä½†ä»å¯ç”³è«‹è³‡é£è²»</p></div>}</>}<div className="bg-red-50 rounded-xl p-3"><h4 className="font-medium text-sm mb-2">ğŸ“„ é›¢è·è­‰æ˜æ›¸</h4><ul className="text-xs text-gray-600 space-y-1"><li>â€¢ å…¬å¸æœ‰ç¾©å‹™é–‹ç«‹</li><li>â€¢ ç¢ºèªé›¢è·ä»£ç¢¼æ­£ç¢ºï¼ˆå½±éŸ¿å¤±æ¥­çµ¦ä»˜ï¼‰</li><li>â€¢ éè‡ªé¡˜é›¢è·éœ€è¨˜è¼‰æ­£ç¢ºæ¢æ¬¾</li></ul></div><div className="bg-green-50 rounded-xl p-3"><h4 className="font-medium text-sm mb-2">ğŸ“‹ æœå‹™è­‰æ˜æ›¸</h4><ul className="text-xs text-gray-600 space-y-1"><li>â€¢ ä¾å‹åŸºæ³•Â§19ï¼Œåƒ…è¨˜è¼‰åˆ°é›¢è·æ—¥ã€è·ä½</li><li>â€¢ ä¸å¾—æœ‰ä»»ä½•ä¸åˆ©è©•èª</li></ul></div><div className="bg-blue-50 rounded-xl p-3"><h4 className="font-medium text-sm mb-2">ğŸ¥ å‹å¥ä¿</h4><ul className="text-xs text-gray-600 space-y-1"><li>â€¢ é›¢è·ç•¶æ—¥é€€ä¿</li><li>â€¢ ç©ºçª—æœŸå¯è‡³å€å…¬æ‰€ä»¥ç¬¬å…­é¡æŠ•ä¿</li><li>â€¢ æˆ–ä¾é™„é…å¶/çˆ¶æ¯çœ·å±¬ä¿</li>{form.isInvoluntary&&<li className="text-blue-600 font-medium">â€¢ é ˜å¤±æ¥­çµ¦ä»˜æœŸé–“å¥ä¿è²»å…¨é¡è£œåŠ©ï¼</li>}</ul></div><div className="bg-purple-50 rounded-xl p-3"><h4 className="font-medium text-sm mb-2">ğŸ” ç«¶æ¥­ç¦æ­¢</h4><ul className="text-xs text-gray-600 space-y-1"><li>â€¢ æª¢æŸ¥åˆç´„æ˜¯å¦æœ‰ã€Œæœˆè£œå„Ÿé‡‘ã€</li><li>â€¢ ç„¡è£œå„Ÿé‡‘çš„ç«¶æ¥­æ¢æ¬¾å¤šç‚ºç„¡æ•ˆ</li></ul></div><div className="bg-gray-50 rounded-xl p-3"><h4 className="font-medium text-sm mb-2">ğŸ’µ å‹é€€6%</h4><ul className="text-xs text-gray-600 space-y-1"><li>â€¢ è‡³<a href="https://edesk.bli.gov.tw/na/" target="_blank" rel="noopener noreferrer" className="text-[#6B8CAE] underline">å‹ä¿å±€eåŒ–æœå‹™</a>æŸ¥è©¢</li><li>â€¢ ç¢ºèªå…¬å¸æ¯æœˆæœ‰è¶³é¡æç¹³</li></ul></div></div><Legal>å¦‚æœ‰å‹è³‡çˆ­è­°ï¼Œå¯æ’¥ <a href="tel:1955" className="font-bold">1955</a> è«®è©¢æˆ–å‘å‹å·¥å±€ç”³è«‹èª¿è§£</Legal><div className="flex gap-3"><Btn onClick={()=>setStage('menu')} variant="secondary"><ChevronLeft className="w-4 h-4"/> è¿”å›</Btn><Btn onClick={()=>setStage('digital')}>æ•¸ä½å®‰å…¨ <ChevronRight className="w-4 h-4"/></Btn></div><Footer/></Page>;

  if(stage==='digital') return <Page><Progress n={9} t={10}/><Enc text="ğŸ”’ æ•¸ä½å®‰å…¨èˆ‡é«”é¢è½‰èº«"/><div className="bg-white rounded-xl p-4 shadow-lg space-y-4"><h3 className="font-bold text-gray-800">æ•¸ä½å®‰å…¨æª¢æŸ¥</h3><div className="bg-red-50 rounded-xl p-3"><h4 className="font-medium text-sm mb-2 text-red-700">ğŸš¨ å¿…åšï¼šå…¬å¸ä¿¡ç®±æ¸…ç†</h4><ul className="text-xs text-gray-600 space-y-1"><li>1. æœå°‹ï¼šé¢è©¦ã€è–ªè³‡ã€é«”æª¢ã€ç§äººã€offer</li><li>2. åˆªé™¤ç›¸é—œéƒµä»¶</li><li>3. æ¸…ç©ºåƒåœ¾æ¡¶ï¼ˆHard Deleteï¼‰</li><li>4. æ¸…ç©ºã€Œå·²åˆªé™¤ã€èˆ‡ã€Œè‰ç¨¿ã€</li></ul></div><div className="bg-amber-50 rounded-xl p-3"><h4 className="font-medium text-sm mb-2">ğŸ”„ å¤–éƒ¨å¸³è™Ÿæ›ç¶</h4><p className="text-xs text-gray-600 mb-2">å…¬å¸ä¿¡ç®±è¨»å†Šçš„æœå‹™æ”¹ç¶å€‹äººä¿¡ç®±ï¼š</p><div className="flex flex-wrap gap-1">{['Notion','Figma','Canva','Slack','Trello','GitHub'].map(s=><span key={s} className="text-xs bg-white px-2 py-1 rounded">{s}</span>)}</div></div><div className="bg-blue-50 rounded-xl p-3"><h4 className="font-medium text-sm mb-2">ğŸ§¹ ç€è¦½å™¨æ¸…ç†</h4><ul className="text-xs text-gray-600 space-y-1"><li>â€¢ ç™»å‡º Chrome/Edge å¸³è™Ÿ</li><li>â€¢ æ¸…é™¤å·²å„²å­˜å¯†ç¢¼</li><li>â€¢ æ¸…é™¤ä¿¡ç”¨å¡è³‡è¨Š</li><li>â€¢ æ¸…é™¤ç€è¦½ç´€éŒ„èˆ‡ Cookies</li></ul></div><div className="bg-green-50 rounded-xl p-3"><h4 className="font-medium text-sm mb-2">ğŸ“ æ–¹æ³•è«–å‚™ä»½</h4><p className="text-xs text-gray-600">âœ“ å¯ä¿ç•™ï¼šå€‹äººæ¨¡æ¿ã€SOPæµç¨‹ã€å­¸ç¿’ç­†è¨˜</p><p className="text-xs text-red-600 mt-1">âœ— ä¸èƒ½å¸¶ï¼šå…¬å¸æ©Ÿå¯†ã€å®¢æˆ¶è³‡æ–™ã€å°ˆæ¡ˆåŸå§‹æª”</p></div><div className="bg-purple-50 rounded-xl p-3"><h4 className="font-medium text-sm mb-2">ğŸ¨ ä½œå“é›†å»è­˜åˆ¥åŒ–</h4><ul className="text-xs text-gray-600 space-y-1"><li>â€¢ æ•¸æ“šè½‰ç™¾åˆ†æ¯”ï¼ˆç‡Ÿæ”¶100è¬â†’æˆé•·30%ï¼‰</li><li>â€¢ æ¨¡ç³ŠåŒ–Logoèˆ‡å“ç‰Œåç¨±</li><li>â€¢ ç¢ºèªä¸é•åNDA</li></ul></div><div className="bg-gray-50 rounded-xl p-3"><h4 className="font-medium text-sm mb-2">ğŸ“ äº¤æ¥æª”æ¡ˆå‘½å</h4><code className="text-xs bg-white px-2 py-1 rounded block">YYYYMMDD_å°ˆæ¡ˆåç¨±_äº¤æ¥ç‰ˆ_v1.0</code></div></div><Warn>å¸¶èµ°å…¬å¸æ©Ÿå¯†å¯èƒ½é•åå‹å‹•å¥‘ç´„åŠæ³•è¦</Warn><div className="flex gap-3"><Btn onClick={()=>setStage('menu')} variant="secondary"><ChevronLeft className="w-4 h-4"/> è¿”å›</Btn><Btn onClick={()=>setStage('complete')}>å®Œæˆ ğŸ‰</Btn></div><Footer/></Page>;

  if(stage==='complete') return <Page><div className="text-center space-y-4 py-8"><div className="text-6xl">ğŸ‰</div><h1 className="text-2xl font-bold text-[#6B8CAE]">æ­å–œå®Œæˆé›¢è·æº–å‚™ï¼</h1><p className="text-gray-600">ç¥æ–°æ—…ç¨‹é †åˆ©</p><div className="bg-gradient-to-r from-[#FFD97D]/20 to-[#FFB6A3]/20 rounded-2xl p-4"><p className="text-[#6B8CAE]">æ¯ä¸€å€‹çµæŸï¼Œéƒ½æ˜¯æ–°é–‹å§‹ã€‚<br/>å‹‡æ•¢è¿½å¤¢ï¼âœ¨</p></div><div className="bg-white rounded-xl p-4 shadow-md text-left"><h3 className="font-bold text-gray-800 mb-2">ğŸ“‹ æœ€å¾Œç¢ºèª</h3><ul className="space-y-1 text-sm text-gray-600"><li>â˜ é›¢è·è­‰æ˜æ›¸</li><li>â˜ æœå‹™è­‰æ˜æ›¸</li><li>â˜ è–ªè³‡/ç‰¹ä¼‘å·²çµç®—</li><li>â˜ å‹å¥ä¿è½‰å‡ºå–®</li><li>â˜ ç‰©å“æ­¸é‚„/å¸¶èµ°</li><li>â˜ åŒäº‹é“åˆ¥</li></ul></div><div className="bg-blue-50 rounded-xl p-4 text-left"><h3 className="font-bold text-gray-800 mb-2">ğŸ’¡ ç©ºçª—æœŸæé†’</h3><ul className="space-y-1 text-xs text-gray-600"><li>â€¢ å¥ä¿å¯è‡³å€å…¬æ‰€ç¬¬å…­é¡åŠ ä¿</li><li>â€¢ éè‡ªé¡˜é›¢è·å¯ç”³è«‹å¤±æ¥­çµ¦ä»˜</li><li>â€¢ å»ºè­°ä¼‘æ¯1-2é€±å†æ±‚è·</li></ul></div><div className="flex flex-col gap-2"><button onClick={()=>setStage('menu')} className="w-full bg-[#6B8CAE] text-white py-3 rounded-full font-medium flex items-center justify-center gap-2"><HomeIcon className="w-4 h-4"/>è¿”å›åŠŸèƒ½</button><button onClick={reset} className="w-full bg-gray-100 text-gray-600 py-3 rounded-full font-medium">é‡æ–°é–‹å§‹</button></div></div><Footer/></Page>;

  return null;
}

export default App;
